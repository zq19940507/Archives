<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>区域维度分析</title>


    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="/css/bootstrap-datetimepicker.min.css">
    <script src="/js/jquery-1.11.3.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/echarts.min.js"></script>
    <script src="js/jquery.js"></script>
    <script src="/js/moment-with-locales.js"></script>
    <script src="/js/bootstrap-datetimepicker.min.js"></script>
    <script src="/js/ecStat.min.js"></script>

    <script>
        window.onload=function(){

            document.getElementById("btn").click();

        }
    </script>


    <style type="text/css">
        .myrow {
            display: flex;
            flex-direction: row;
            /*margin-left:1em;*/
        }

        .xxxx {
            height: 2px;
            background: #999999;
            margin-top: 16px;
            width: 1em;
            margin-left: 1em;
            margin-right: 1em;
        }
    </style>

    <style>
        .box {
            width: 1300px;
            height: 500px;
            background-color: white;
        }
    </style>


    <style>
        .box1 {
            width: 800px;
            height: 500px;
            background-color: white;

        }
    </style>

</head>
<body>


<div class="container">

    <div class="">


        <h2 align="center">区域维度分析</small></h2>

        <div>

            <div class="dropdown" style="float: left">
                <button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown"
                        aria-haspopup="true" aria-expanded="true">
                    查看其它
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">

                    <li><a href="/cm2">光交箱分析</a></li>
                    <li><a href="/cm3">装维及时率分析</a></li>
                    <li><a href="/cm4">装维满意度分析</a></li>
                    <li><a href="/cm5">网元投诉分析</a></li>
                    <li><a href="/cm6">小区事件分析</a></li>
                    <li role="separator" class="divider"></li>
                    <li><a href="/navigation">返回首页</a></li>
                </ul>
            </div>


            <!--            <div class="" style="float: right">-->
            <!--                <a  data-toggle="modal" data-target="#events" type="button" id=""  aria-haspopup="true" aria-expanded="true">-->
            <!--                    小区事件查看-->
            <!--                </a>-->

            <!--            </div>-->





            <!--            <div class="modal fade" id="events" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">-->
            <!--                <div class="modal-dialog">-->
            <!--                    <div class="modal-content">-->
            <!--                        <div class="modal-header">-->
            <!--                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>-->
            <!--                            <h4 class="modal-title" id="myModalLabel">小区事件</h4>-->
            <!--                        </div>-->
            <!--                        <div class="modal-body">-->
            <!--                            -->
            <!--                        </div>-->
            <!--                        <div class="modal-footer">-->
            <!--                            <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>-->
            <!--                            <button type="button" class="btn btn-primary">导出明细</button>-->
            <!--                        </div>-->
            <!--                    </div>&lt;!&ndash; /.modal-content &ndash;&gt;-->
            <!--                </div>&lt;!&ndash; /.modal &ndash;&gt;-->
            <!--            </div>-->


        </div>


    </div>

</div>


<br>

<div class="container">

    <div class="row ">

        <div class="col-md-2" style="float: left">
            <div class="input-group">
                <div class="input-group-btn">
                    <a type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">单元 <span class="caret"></span></a>
                    <ul class="dropdown-menu" id="dany" onclick="dany" th:method="get">
                        <li><a href="#">市区分公司</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">新区分公司</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">丹徒分公司</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">丹阳分公司</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">扬中分公司</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">句容分公司</a></li>
                        <li role="separator" class="divider"></li>
                    </ul>
                </div><!-- /btn-group -->
                <form id="ccdy">
                    <input type="text" id="dy_in" class="form-control" name="danyuan" value="" aria-label="..."
                           placeholder="==请选择==">
                </form>
            </div><!-- /input-group -->
        </div>

        <!--        选择显示单元在inptu标签里-->
        <script>
            $("#dany").on("click", "li", function () {
                $("#dy_in").val($(this).text());
            });
        </script>


        <div class="col-md-2 " style="float: left">
            <div class="input-group">
                <div class="input-group-btn ">
                    <a type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown"
                       aria-haspopup="true" aria-expanded="false">网格 <span class="caret"></span></a>
                    <ul class="dropdown-menu" id="wg" style="height:400px;overflow:scroll">
                        <li><a href="#">梦溪区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">北固区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">南徐区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">宝塔区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">象山区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">金山区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">高新区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">谏壁区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">南山区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">市区校园区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">大港区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">丁北区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">丁南区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">丁岗区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">姚桥区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">宜城区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">高资区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">辛丰区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">谷阳区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">上党区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">宝堰区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">丹徒校园区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">丹阳丹北区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">丹阳曲阿区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">丹阳云阳区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">司徒区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">丹阳高新区区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">吕城区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">丹阳城西区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">皇塘区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">丹阳界牌区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">陵口区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">丹阳工业园区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">扬中城西区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">新坝区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">扬中城东区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">八桥区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">油坊区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">华阳区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">句容开发区区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">崇明区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">宝华区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">边白区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">下蜀区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">天王区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">茅山区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">郭庄区域中心</a></li>
                        <li role="separator" class="divider"></li>
                        <li><a href="#">后白区域中心</a></li>
                    </ul>
                </div><!-- /btn-group -->
                <form id="czwg">
                    <input type="text" class="form-control" id="wangge" value="" aria-label="..." placeholder="==请选择==">
                </form>

            </div><!-- /input-group -->
        </div>

        <!--        选择网格单元在inptu标签里-->
        <script>
            $("#wg").on("click", "li", function () {
                $("#wangge").val($(this).text());
            });
        </script>

        <script>
            $("#dany").on("click", "li", function () {
                var wgreact = window.document.getElementById("wg");
                var dan_y = document.getElementById("dy_in").value;
                var html1 = "";
                console.log(dan_y);
                console.log("ceshi");
                if (dan_y == "市区分公司") {
                    html1 +=
                        '<li><a href="#"  >梦溪区域中心</a></li>\n' +
                        '               <li role="separator" class="divider"></li>\n' +
                        '               <li><a href="#"  >北固区域中心</a></li>\n' +
                        '               <li role="separator" class="divider"></li>\n' +
                        '               <li><a href="#"  >南徐区域中心</a></li>\n' +
                        '               <li role="separator" class="divider"></li>\n' +
                        '               <li><a href="#"  >宝塔区域中心</a></li>\n' +
                        '               <li role="separator" class="divider"></li>\n' +
                        '               <li><a href="#"  >象山区域中心</a></li>\n' +
                        '               <li role="separator" class="divider"></li>\n' +
                        '               <li><a href="#"  >金山区域中心</a></li>\n' +
                        '               <li role="separator" class="divider"></li>\n' +
                        '               <li><a href="#"  >高新区域中心</a></li>\n' +
                        '               <li role="separator" class="divider"></li>\n' +
                        '               <li><a href="#"  >谏壁区域中心</a></li>\n' +
                        '               <li role="separator" class="divider"></li>\n' +
                        '               <li><a href="#"  >南山区域中心</a></li>\n' +
                        '               <li role="separator" class="divider"></li>\n' +
                        '               <li><a href="#"  >市区校园区域中心</a></li>\n' +
                        '               <li role="separator" class="divider"></li>';
                    wgreact.innerHTML = html1;
                } else if (dan_y == "新区分公司") {
                    html1 += '<li><a href="#"  >大港区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >丁北区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >丁南区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >丁岗区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >姚桥区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>';
                    wgreact.innerHTML = html1;

                } else if (dan_y == "丹徒分公司") {
                    html1 += '<li><a href="#"  >宜城区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >高资区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >辛丰区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >谷阳区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >上党区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >宝堰区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >丹徒校园区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>';
                    wgreact.innerHTML = html1;
                } else if (dan_y == "丹阳分公司") {
                    html1 += '<li><a href="#"  >丹阳丹北区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >丹阳曲阿区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >丹阳云阳区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >司徒区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >丹阳高新区区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >吕城区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >丹阳城西区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >皇塘区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >丹阳界牌区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >陵口区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >丹阳工业园区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>';
                    wgreact.innerHTML = html1;
                } else if (dan_y == "扬中分公司") {
                    html1 += '<li><a href="#"  >扬中城西区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >新坝区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >扬中城东区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >八桥区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >油坊区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>';
                    wgreact.innerHTML = html1;
                } else if (dan_y == "句容分公司") {
                    html1 += '<li><a href="#"  >华阳区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >句容开发区区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >崇明区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >宝华区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >边白区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >下蜀区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >天王区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >茅山区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >郭庄区域中心</a></li>\n' +
                        '                        <li role="separator" class="divider"></li>\n' +
                        '                        <li><a href="#"  >后白区域中心</a></li>';
                    wgreact.innerHTML = html1;
                }

            });
        </script>

        <div class="input-group col-md-2" style="float: left">
            <span class="input-group-addon" id="sizing-addon2">小区</span>
            <form id="xiaoqu">
                <input type="text" class="form-control" id="xiaoqu_in" name="comm" placeholder="请输入小区名"
                       aria-describedby="sizing-addon2">
            </form>
        </div>

        <div class=" col-md-3 " role="group" aria-label="..." style="float: left">
            <button type="button" id="btn" tag="cbtn" class="btn btn-primary" onclick="dian()">查询</button>
            <button type="button" class="btn btn-info" onclick="formReset()" value="Reset form">重置</button>

            <button class="btn btn-success" data-target="#myModal" data-toggle="modal">
                导入数据
            </button>


            <!--            点击按钮获取参数到后端-->

            <script>
                function formReset() {
                    document.getElementById("ccdy").reset();
                    document.getElementById("czwg").reset();
                    document.getElementById("xiaoqu").reset();
                }

            </script>


            <a class="btn btn-warning">
                日期
            </a>
            <!--fade 淡入淡出-->
            <div class="modal fade" id="myModal" aria-labelledby="myModallabel" aria-hidden="true" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">

                        <div class="modal-header">
                            <button class="close" type="button" data-dismiss="modal" aria-hidden="true">&times;</button>
                            <h5 class="modal-title" id="myModallabel " style="margin: auto;">请选择文件</h5>
                        </div>

                        <form id="formData" class="form-horizontal">

                            <div class="modal-body">
                                <div class="form-group ">
                                    <form>
                                        <div class="form-group" style="margin: auto;">

                                            <input type="file" id="exampleInputFile">

                                        </div>
                                    </form>
                                </div>

                            </div>


                            <div class="modal-footer">
                                <button class="btn btn-success" type="button" onclick="">提交</button>
                                <button class="btn btn-danger" type="button" data-dismiss="modal">关闭</button>
                            </div>

                        </form>


                    </div>
                </div>
            </div>


        </div>

        <!--=====================时间组件=====================-->


        <div class="form-group col-md-3 " style="float: left">


            <div class="myrow">

                <div class='input-group date' style="width: 10em;" id='datetimepicker1'>
                    <input type='text' id="start_time" class="timeInput form-control" style="width: 100px"/>
                    <span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                    </span>
                </div>
                <div class="xxxx">

                </div>
                <div class='input-group date' style="width: 10em;" id='datetimepicker2'>
                    <input type='text' id="end_time" class="timeInput form-control" style="width: 100px"/>
                    <span class="input-group-addon">
                    <span class="glyphicon glyphicon-calendar"></span>
                    </span>
                </div>
            </div>
        </div>


        <script>
            $(function () {
                $('#form1').hide();
                var picker1 = $('#datetimepicker1').datetimepicker({
                    format: 'YYYY-MM-DD',
                    locale: moment.locale('zh-cn'),
                    //minDate: '2016-7-1'
                });
                var picker2 = $('#datetimepicker2').datetimepicker({
                    format: 'YYYY-MM-DD',
                    locale: moment.locale('zh-cn')
                });
                //动态设置最小值
                picker1.on('dp.change', function (e) {
                    picker2.data('DateTimePicker').minDate(e.date);
                });
                //动态设置最大值
                picker2.on('dp.change', function (e) {
                    picker1.data('DateTimePicker').maxDate(e.date);
                });
            });
            $('#datetimepicker1').datetimepicker({
                format: 'YYYY-MM-DD',
                locale: moment.locale('zh-cn'),
                defaultDate: "2020-12-01"
            });
            $('#datetimepicker2').datetimepicker({
                format: 'YYYY-MM-DD',
                locale: moment.locale('zh-cn'),
                defaultDate: "2020-12-14"
            });
        </script>


        <!--=====================时间组件=====================-->


    </div><!-- /.row -->

</div>
<br>
<br>
<div class="box container   " id="main" style="height:500px"></div>
<br>
<br>
<!--================end================-->
<div class="container">
    <table class="table table-bordered">
        <caption>小区广义万投比TOP50
            <button style="float: right" class="btn btn-success" type="btn" id="btn2">数据导出</button>
        </caption>


        <thead>
        <tr bgcolor="#1e90ff">
            <th class="text-center">单元</th>
            <th class="text-center">区域中心</th>
            <th class="text-center">代维单位</th>
            <th class="text-center">小区名称</th>
            <th class="text-center">小区ID</th>
            <th class="text-center">广义投诉量</th>
            <th class="text-center">在网用户数（管线）</th>
            <th class="text-center">广义万投比</th>
        </tr>
        </thead>


        <tbody id="tbody-result">


        </tbody>


    </table>


</div>



<div class="modal fade"  id="events" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">网元投诉分析</h4>
            </div>
            <div class="modal-body box1 container" style="width: 500px">

                <!--                            <div class="box1 container "  id="main1" style="height:500px "></div>-->

            </div>


            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>

            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>


<script type="text/javascript" th:inline="javascript">


    var myChart = echarts.init(document.querySelector(".box"));

    var myChart1 = echarts.init(document.querySelector(".box1"));

    var btn = document.getElementById("btn");
    var btn2 = document.getElementById("btn2")

    btn.onclick = function () {

        var ajaxObj = new XMLHttpRequest();
        // 单元
        var dan_y = document.getElementById("dy_in").value;
        // 区域中心
        var wang_ge = document.getElementById("wangge").value;
        console.log(wang_ge);
        //小区
        var xiaoqu_in = document.getElementById("xiaoqu_in").value;

        // 开始时间
        var start_time = document.getElementById("start_time").value;
        // 结束时间
        var end_time = document.getElementById("end_time").value;
        // alert(end_time);

        var wgreact = window.document.getElementById("wg");


        // ==========返回前端数据==============

        stime = document.getElementById("start_time").value; //开始日期
        etime = document.getElementById("end_time").value; //结束日期


        getdiffdate(stime, etime);
        //获取两日期之间日期列表函数

        //获取两日期之间日期列表函数
        function getdiffdate(stime, etime) {
            //初始化日期列表，数组
            var diffdate = new Array();
            var i = 0;
            var arrday = [];
            //开始日期小于等于结束日期,并循环
            while (stime <= etime) {
                diffdate[i] = stime;

                //获取开始日期时间戳

                arrday.push(stime);
                var stime_ts = new Date(stime).getTime();


                //增加一天时间戳后的日期
                var next_date = stime_ts + (24 * 60 * 60 * 1000);

                //拼接年月日，这里的月份会返回（0-11），所以要+1
                var next_dates_y = new Date(next_date).getFullYear() + '-';
                var next_dates_m = (new Date(next_date).getMonth() + 1 < 10) ? '0' + (new Date(next_date).getMonth() + 1) + '-' : (new Date(next_date).getMonth() + 1) + '-';
                var next_dates_d = (new Date(next_date).getDate() < 10) ? '0' + new Date(next_date).getDate() : new Date(next_date).getDate();

                stime = next_dates_y + next_dates_m + next_dates_d;

                //增加数组key
                i++;
            }

            // alert(arrday);
            return arrday;
        }


        var arr = [];
        // for(var i=0;i<wan.length;i++){
        //     // alert(wan[i].value);
        //     arr.push(wan[i].value)
        // }


        var arr1 = [];
        // for(var i=0;i<wan1.length;i++){
        //     // alert(wan[i].value);
        //     arr1.push(wan1[i].value)
        // }
        var arr2 = [];
        var arr3 = [];
        var arr4 = [];
        var arr5 = [];

        var arr6 = [];
        var arr7 = [];
        var arr8 = [];
        var arr9 = [];
        var arr10 = [];
        var arr11 = [];
        var arr12 = [];
        var arr13 = [];


        $.get('/data?start_time=' + start_time + '&end_time=' + end_time
            + '&dan_y=' + dan_y + '&wang_ge=' + wang_ge + '&xiaoqu_in=' + xiaoqu_in, function (res) {
            if (res) {

                col = res.wtbs;
                console.log("col", col);

                brakdown=res.breakDowns;

                console.log("群障", brakdown);


                colall = res.wtbsall;

                weather = res.weathers;
                // console.log("weather",weather);
                wgwtb = res.wgWtbs;
                // console.log("wgwtb",wgwtb);

                var wgwtbdata = [];
                var wgwtbdata1 = [];
                for (var i = 0; i < wgwtb.length; i++) {
                    wgwtbdata.push(wgwtb[i].wantoubi);
                    wgwtbdata1.push(wgwtb[i].wangge);
                }

                console.log("区域中心万投比",wgwtbdata);

                var wgwtbdata_linear = [];
                for (var i = 0; i < wgwtbdata.length; i++){

                    wgwtbdata_linear.push( [i,wgwtbdata[i]]  );
                }

                console.log("区域中心万投比投比趋势点",wgwtbdata_linear);

                echartsAll = res.echartdy;

                // console.log("echartsAll",echartsAll);

                var echartsAllwtb = [];
                var echartsAllwtb1 = [];
                for (var i = 0; i < echartsAll.length; i++) {
                    echartsAllwtb.push(echartsAll[i].wantoubi);
                    echartsAllwtb1.push(echartsAll[i].dy);
                }
                console.log("单元万投比="+echartsAllwtb);



                var echartsAllwtb_linear = [];
                for (var i = 0; i < echartsAllwtb.length; i++){

                    echartsAllwtb_linear.push([i,echartsAllwtb[i]]);
                }

                console.log("单元万投比投比趋势点",echartsAllwtb_linear);


                var date_weather = [];
                for (var i = 0; i < weather.length; i++) {
                    date_weather.push(weather[i].time + '\n' + weather[i].tianqi + '\n' + weather[i].temperature);
                }


                // ============================


                var tbody = window.document.getElementById("tbody-result");
                var html = "";

                // var html = '<table border=1>';

                for (var j in col) {
                    var obj = col[j];

                    function work(target) {
                        //e.preventDefault();
                        alert($(target).text());
                    }

                    href_ = "/cm5?xiaoqu_in=" + obj.community + "&start_time=" + start_time + "&end_time=" + end_time;
                    href1_ = " data-toggle=\"modal\" data-target=\"#events\" type=\"button\" id=\"\"  aria-haspopup=\"true\" aria-expanded=\"true\" "

                    html += '<tr>'
                    html += '<td class="text-center">' + obj.location + '</td>';
                    html += '<td class="text-center">' + obj.zone + '</td>';
                    html += '<td class="text-center">' + obj.dw + '</td>';
                    // html += '<td class="text-center" id="objc">' + ' <a  ' + href1_ + '   > ' + obj.community + '</a>' + '</td>';

                    html += '<td class="text-center" id="objc">' + ' <a href= ' + href_ + ' target="_blank"  > ' + obj.community + '</a>' + '</td>';
                    // html += '<td class="text-center">'+'<a href="">' + obj.id +'</a>'+ '</td>';
                    html += '<td class="text-center">' + obj.id + '</td>';
                    html += '<td class="text-center">' + obj.complaint + '</td>';
                    html += '<td class="text-center">' + obj.user_amount + '</td>';
                    html += '<td class="text-center">' + obj.wtb_amount + '</td>';
                    html += '</tr>';



                }

                // html += '</table>';
                //
                // $('#treeList1').append(html);
                tbody.innerHTML = html;


                // ============================
                tengpon = res.tenGpons;
                console.log("tengpon", tengpon);
                // var echarts1 = res.echart1_dies;
                echarts1 = res.echart1_dies;
                echarts2 = res.echart2_xqs;
                console.log("echarts2", echarts2);


                var middle = [];
                for (var i = 0; i < echarts2.length; i++)
                    for (var j = 0; j < tengpon.length; j++) {
                        for (var k = 0; k < weather.length; k++) {
                            if (echarts2[i].community == tengpon[j].name & echarts2[i].day == tengpon[j].time & tengpon[j].time == weather[k].time)
                                middle.push({
                                    name: "投诉",
                                    value: "",
                                    xAxis: echarts2[i].day + '\n' + weather[k].tianqi + '\n' + weather[k].temperature,
                                    yAxis: echarts2[i].wantoubi
                                });

                        }

                    }

                console.log("middle", middle);
                console.log("date_weather", date_weather);


                var middle1 = [];
                for (var i = 0; i < echarts2.length; i++)
                    for (var j = 0; j < brakdown.length; j++) {
                        for (var k = 0; k < weather.length; k++) {
                            if (echarts2[i].community == brakdown[j].community & echarts2[i].day == brakdown[j].s_time & brakdown[j].s_time == weather[k].time)
                                middle1.push({
                                    name: "投诉",
                                    value: "",
                                    xAxis: echarts2[i].day + '\n' + weather[k].tianqi + '\n' + weather[k].temperature,
                                    yAxis: echarts2[i].wantoubi
                                });

                        }

                    }
                console.log("middle1", middle1);



                function ten(middle) {
                    if (middle.length == 0) {
                        return;

                    } else {
                        for (let i = 0; i < middle.length; i++) {

                            return middle[i];
                        }
                    }

                }


                function unique(array) {
                    return Array.from(new Set(array))
                }

                var xqarr = [];
                for (let ex of echarts2) {
                    xqarr.push(ex.wantoubi);
                }
                console.log("小区万投比",xqarr);

                var xqarr_linear = [];
                for (var i = 0; i < xqarr.length; i++){

                    xqarr_linear.push([i,xqarr[i]]);
                }

                console.log("小区万投比趋势点",xqarr_linear);






                var xqarr1 = [];
                for (let ex of echarts2) {
                    xqarr1.push(ex.community);
                }
                unxqarr1 = unique(xqarr1);

                // echartsAllwtb1单元
                // wgwtbdata1网格
                unechartsAllwtb1 = unique(echartsAllwtb1);
                unwgwtbdata1 = unique(wgwtbdata1);

                for (let e1 of echarts1) {
                    arr.push(e1.wantoubi);
                }
                var echarts2 = res.echart2_dies;
                for (let e2 of echarts2) {
                    arr1.push(e2.wantoubi);
                }

                var echarts3 = res.echart3_dies;
                for (let e3 of echarts3) {
                    arr2.push(e3.wantoubi);
                }

                var echarts4 = res.echart4_dies;
                for (let e4 of echarts4) {
                    arr3.push(e4.wantoubi);
                }

                var echarts5 = res.echart5_dies;
                for (let e5 of echarts5) {
                    arr4.push(e5.wantoubi);
                }

                var echarts6 = res.echart6_dies;
                for (let e6 of echarts6) {
                    arr5.push(e6.wantoubi);
                }

                // 单元
                var col1 = res.wtbs;
                for (let t1 of col1) {
                    arr6.push(t1.location);

                }
                // alert(arr6)
                // 区域中心
                var col2 = res.wtbs;
                for (let t2 of col2) {
                    // arr7.push(t2.zone);

                }
                // alert(arr7)
                // 代维单位
                var col3 = res.wtbs;
                for (let t3 of col3) {
                    // arr8.push(t3.dw);

                }
                // alert(arr8)
                // 小区名称
                var col4 = res.wtbs;
                for (let t4 of col4) {
                    arr9.push(t4.community);

                }
                // alert(arr9)
                // 小区ID
                var col5 = res.wtbs;
                for (let t5 of col5) {
                    arr10.push(t5.id);

                }
                // alert(arr10)
                // 广义投诉量
                var col6 = res.wtbs;
                for (let t6 of col6) {
                    arr11.push(t6.complaint);

                }
                // alert(arr11)
                // 在网用户数（管线）
                var col7 = res.wtbs;
                for (let t7 of col7) {
                    arr12.push(t7.user_amount);

                }
                // alert(arr12)
                // 广义万投比
                var col8 = res.wtbs;
                for (let t8 of col8) {
                    arr13.push(t8.wtb_amount);

                }
                // alert(arr13)

              /*  小区万投比趋势点 , xqarr_linear

                单元万投比投比趋势点 , echartsAllwtb_linear
                区域中心万投比投比趋势点 , wgwtbdata_linear

                */

                var myRegression = ecStat.regression('linear', xqarr_linear);


                console.log("小区趋势点",myRegression.points);


                // =========================================

                var myRegression1 = ecStat.regression('linear', echartsAllwtb_linear);


                console.log("单元趋势点",myRegression1.points);
                // ===========================================
                var myRegression2 = ecStat.regression('linear', wgwtbdata_linear);


                console.log("网格趋势点",myRegression2.points);


                var xqlinear=[];

                for(var i=0;i<myRegression.points.length;i++){
                    xqlinear.push(myRegression.points[i].pop());

                }
                // console.log(xqlinear);

                var dylinear=[];

                for(var i=0;i<myRegression1.points.length;i++){
                    dylinear.push(myRegression1.points[i].pop());

                }

                var wglinear=[];

                for(var i=0;i<myRegression2.points.length;i++){
                    wglinear.push(myRegression2.points[i].pop());

                }









                var option = {

                    title: {
                        text: '全区广义投诉量（万投比）', left: 'center'
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'cross',
                            label: {
                                backgroundColor: '#6a7985'
                            }
                        }

                    },
                    legend: {
                        data: ['市区分公司', '新区分公司', '丹徒分公司', '丹阳分公司', '扬中分公司', '句容分公司'],
                        bottom: 0,
                        icon: "rect"
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '8%',
                        containLabel: true
                    },
                    toolbox: {
                        feature: {
                            saveAsImage: {}
                        }
                    },
                    xAxis: {
                        name: "日期",
                        type: 'category',
                        boundaryGap: false,
                        // data: getdiffdate(stime,etime)
                        data: date_weather
                    },
                    yAxis: {
                        name: "万投比",
                        type: 'value'
                    },
                    series: [
                        {
                            name: '市区分公司',
                            type: 'line',
                            data: arr,

                            itemStyle: {normal: {label: {show: true}}}
                        },
                        {
                            name: '新区分公司',
                            type: 'line',

                            data: arr1,
                            itemStyle: {normal: {label: {show: true}}}
                        },
                        {
                            name: '丹徒分公司',
                            type: 'line',

                            data: arr2,
                            itemStyle: {normal: {label: {show: true}}}
                        },
                        {
                            name: '丹阳分公司',
                            type: 'line',

                            data: arr3,
                            itemStyle: {normal: {label: {show: true}}}
                        },
                        {
                            name: '扬中分公司',
                            type: 'line',

                            data: arr4,
                            itemStyle: {normal: {label: {show: true}}}
                        },

                        {
                            name: '句容分公司',
                            type: 'line',

                            data: arr5,
                            itemStyle: {normal: {label: {show: true}}}
                        }
                    ]
                };
                // ====单元
                var option1 = {

                    title: {
                        text: '单元广义投诉量（万投比）', left: 'center'
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'cross',
                            label: {
                                backgroundColor: '#6a7985'
                            }
                        },


                    },


                    legend: {
                        data: unechartsAllwtb1,
                        bottom: 0,
                        icon: "rect"
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '8%',
                        containLabel: true
                    },
                    toolbox: {
                        feature: {
                            saveAsImage: {}
                        }
                    },

                    xAxis: {
                        name: "日期",
                        type: 'category',
                        boundaryGap: false,
                        data: date_weather
                    },

                    yAxis: {
                        name: "万投比",
                        type: 'value'
                    },


                    series: [
                        {
                            name: unechartsAllwtb1,
                            type: 'line',
                            data: echartsAllwtb,

                            itemStyle: {
                                normal:

                                    {
                                        label:
                                            {
                                                show: true
                                            }
                                    }
                            },


                        },

                        {
                            name: '趋势线',
                            type: 'line',
                            data: dylinear,

                            itemStyle: {normal: {



                                    lineStyle:{

                                        type:'dotted'  //'dotted'虚线 'solid'实线
                                    }

                                }
                            }
                        },
                    ]
                };

                // ===========区域中心
                var option2 = {

                    title: {
                        text: '区域中心广义投诉量（万投比）', left: 'center'
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'cross',
                            label: {
                                backgroundColor: '#6a7985'
                            }
                        },


                    },


                    legend: {
                        data: unwgwtbdata1,
                        bottom: 0,
                        icon: "rect"
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '8%',
                        containLabel: true
                    },
                    toolbox: {
                        feature: {
                            saveAsImage: {}
                        }
                    },

                    xAxis: {
                        name: "日期",
                        type: 'category',
                        boundaryGap: false,
                        data: date_weather
                    },

                    yAxis: {
                        name: "万投比",
                        type: 'value'
                    },


                    series: [
                        {
                            name: unwgwtbdata1,
                            type: 'line',
                            data: wgwtbdata,

                            itemStyle: {
                                normal:

                                    {
                                        label:
                                            {
                                                show: true
                                            }
                                    }
                            },


                        },

                        {
                            name: '趋势线',
                            type: 'line',
                            data: wglinear,

                            itemStyle: {normal: {



                                    lineStyle:{

                                        type:'dotted'  //'dotted'虚线 'solid'实线
                                    }

                                }
                            }
                        },
                    ]
                };
                // ========小区
                var option3 = {

                    title: {
                        text: '小区广义投诉量（万投比）', left: 'center'
                    },
                    tooltip: {
                        trigger: 'axis',
                        axisPointer: {
                            type: 'cross',
                            label: {
                                backgroundColor: '#6a7985'
                            }
                        },


                    },


                    legend: {
                        data: unxqarr1,

                        bottom: 0,
                        icon: "rect"
                    },
                    grid: {
                        left: '3%',
                        right: '4%',
                        bottom: '8%',
                        containLabel: true
                    },
                    toolbox: {
                        feature: {
                            saveAsImage: {}
                        }
                    },

                    xAxis: {
                        name: "日期",
                        type: 'category',
                        boundaryGap: false,
                        data: date_weather
                    },

                    yAxis: {
                        name: "万投比",
                        type: 'value'
                    },


                    series: [
                        {
                            name: unxqarr1,
                            type: 'line',
                            data: xqarr,
                            markPoint: {
                                data: middle,
                                symbol: 'diamond',
                                symbolSize: [20, 20],// 容器大小
                                symbolOffset: [0, -40],//位置偏移



                            },

                            // markPoint1: {
                            //     data: middle1,
                            //     symbol: 'triangle',
                            //     symbolSize: [20, 20],// 容器大小
                            //     symbolOffset: [0, -60],//位置偏移
                            //
                            //
                            //
                            // },




                            itemStyle: {
                                normal:

                                    {
                                        // color:'black',

                                        label: {show: true}
                                    }
                            },


                        },


                        {
                            name: unxqarr1,
                            type: 'line',
                            data: xqarr,
                            // markPoint: {
                            //     data: middle,
                            //     symbol: 'diamond',
                            //     symbolSize: [20, 20],// 容器大小
                            //     symbolOffset: [0, -40],//位置偏移



                            // },

                            markPoint: {
                                data: middle1,
                                symbol: 'triangle',
                                symbolSize: [20, 20],// 容器大小
                                symbolOffset: [0, -60],//位置偏移



                            },


                            itemStyle: {
                                normal: {
                                        // lineStyle:{
                                        //     color:'black'
                                        // },
                                    label: {show: true}
                                    }
                            },


                        },


                        {
                            name: '趋势线',
                            type: 'line',
                            data: xqlinear,

                            itemStyle: {normal: {



                                                lineStyle:{

                                                    type:'dotted'  //'dotted'虚线 'solid'实线
                                                            }

                                                }
                                        }
                        },


                    ]


                };


                if (dan_y == "") {
                    var x1 = 0;
                } else {
                    var x1 = 1;
                }

                if (wang_ge == "") {
                    var x2 = 0;
                } else {
                    var x2 = 2;
                }

                if (xiaoqu_in == "") {
                    var x3 = 0;
                } else {
                    var x3 = 3;
                }

                var xa = [];
                xa.push(x1);
                xa.push(x2);
                xa.push(x3);
                // console.log("xa",xa);


                var max = Math.max.apply(null, xa);
                // console.log("max",max);


                // if (xiaoqu_in==""){
                //     myChart.setOption(option,true);
                // }
                //
                // else {
                //     if (unxqarr1.length==1 ){
                //
                //         myChart.setOption(option3,true);
                //
                // }
                //     else {
                //      alert("折线图展示请输入小区具体唯一名称");
                //  }
                //
                // }

                if (max == 0) {
                    //全区
                    myChart.setOption(option, true);
                } else if (max == 1) {
                    //单元
                    myChart.setOption(option1, true);
                } else if (max == 2) {
                    //区域中心
                    myChart.setOption(option2, true);
                } else if (max == 3) {

                    if (unxqarr1.length == 1) {
                        //单元
                        myChart.setOption(option3, true);

                    } else {
                        alert("折线图展示请输入小区具体唯一名称");
                    }
                }


            }
        });

    }


    // optionx = {
    //     tooltip: {
    //         trigger: 'item',
    //         formatter: '{a} <br/>{b}: {c} ({d}%)'
    //     },
    //     legend: {
    //         orient: 'vertical',
    //         left: 0,
    //         data: [1, 2, 3, 4]
    //     },
    //     series: [
    //         {
    //             name: '一级原因',
    //             type: 'pie',
    //             selectedMode: 'single',
    //             radius: [0, '30%'],
    //
    //             label: {
    //                 position: 'inner'
    //
    //             },
    //             labelLine: {
    //                 show: false
    //             },
    //             data: [1, 2, 3, 4]
    //
    //         },
    //         {
    //             name: '二级原因',
    //             type: 'pie',
    //             radius: ['40%', '55%'],
    //             label: {
    //                 formatter: '{a|{a}}{abg|}\n{hr|}\n  {b|{b}：}{c}  {per|{d}%}  ',
    //                 backgroundColor: '#eee',
    //                 borderColor: '#aaa',
    //                 borderWidth: 1,
    //                 borderRadius: 4,
    //                 // shadowBlur:3,
    //                 // shadowOffsetX: 2,
    //                 // shadowOffsetY: 2,
    //                 // shadowColor: '#999',
    //                 // padding: [0, 7],
    //                 rich: {
    //                     a: {
    //                         color: '#999',
    //                         lineHeight: 22,
    //                         align: 'center'
    //                     },
    //                     // abg: {
    //                     //     backgroundColor: '#333',
    //                     //     width: '100%',
    //                     //     align: 'right',
    //                     //     height: 22,
    //                     //     borderRadius: [4, 4, 0, 0]
    //                     // },
    //                     hr: {
    //                         borderColor: '#aaa',
    //                         width: '100%',
    //                         borderWidth: 0.5,
    //                         height: 0
    //                     },
    //                     b: {
    //                         fontSize: 10,
    //                         lineHeight: 4
    //                     },
    //                     per: {
    //                         color: '#eee',
    //                         backgroundColor: '#334455',
    //                         padding: [2, 4],
    //                         borderRadius: 2
    //                     }
    //                 }
    //             },
    //             data: [1, 2, 3, 4]
    //
    //         }
    //     ]
    // };

    // myChart1.setOption(optionx, true);


    btn2.onclick = function () {
        // console.log(result);

        //要导出的json数据
        //列标题，逗号隔开，每一个逗号就是隔开一个单元格
        let str = `单元,区域中心,代维单位,小区名称,小区ID,广义投诉量,在网用户数（管线）,广义万投比\n`;
        //增加\t为了不让表格显示科学计数法或者其他格式
        for (let i = 0; i < colall.length; i++) {
            for (let item in colall[i]) {
                str += `${colall[i][item] + '\t'},`;
            }
            str += '\n';
        }
        //encodeURIComponent解决中文乱码
        let uri = 'data:text/csv;charset=utf-8,\ufeff' + encodeURIComponent(str);
        //通过创建a标签实现
        let link = document.createElement("a");
        link.href = uri;
        //对下载的文件命名
        link.download = stime + "至" + etime + "小区万投比明细.csv";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);

    }



    // var myRegression = ecStat.regression('linear', data);
    //
    // myRegression.points.sort(function(a, b) {
    //     return a[0] - b[0];
    // });
    //
    // console.log("myRegression="+myRegression);


</script>


</body>
</html>
